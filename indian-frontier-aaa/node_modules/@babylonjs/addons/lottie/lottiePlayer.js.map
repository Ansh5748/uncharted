{"version":3,"file":"lottiePlayer.js","sourceRoot":"","sources":["../../../../dev/addons/src/lottie/lottiePlayer.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Nullable } from \"core/types\";\r\n\r\n/**\r\n * Configuration options for the Lottie animation player.\r\n */\r\nexport type AnimationConfiguration = {\r\n    /**\r\n     * Whether the animation should play on a loop or not\r\n     */\r\n    loopAnimation: boolean;\r\n    /**\r\n     * Size of the sprite atlas texture.\r\n     * Default is 2048.\r\n     */\r\n    spriteAtlasSize: number;\r\n    /**\r\n     * Gap size around sprites in the atlas.\r\n     * Default is 5.\r\n     */\r\n    gapSize: number;\r\n    /**\r\n     * Maximum number of sprites the renderer can handle at once.\r\n     * Default is 64.\r\n     */\r\n    spritesCapacity: number;\r\n    /**\r\n     * Background color for the animation canvas.\r\n     * Default is white with full opacity.\r\n     */\r\n    backgroundColor: { r: number; g: number; b: number; a: number };\r\n    /**\r\n     * Minimum scale factor to prevent too small sprites.\r\n     * Default is 5.\r\n     */\r\n    scaleMultiplier: number;\r\n    /**\r\n     * Scale factor for the rendering.\r\n     * Default is 1.\r\n     */\r\n    devicePixelRatio: number;\r\n    /**\r\n     * Number of steps to sample cubic bezier easing functions for animations.\r\n     * Default is 4.\r\n     */\r\n    easingSteps: number;\r\n    /**\r\n     * Whether to ignore opacity animations for performance.\r\n     * Default is true.\r\n     */\r\n    ignoreOpacityAnimations: boolean;\r\n    /**\r\n     * Whether to support device lost events for WebGL contexts.\r\n     * Default is false.\r\n     */\r\n    supportDeviceLost: boolean;\r\n};\r\n\r\n/**\r\n * LottiePlayer is a class that allows you to play Lottie animations using Babylon.js.\r\n * It plays the animations in a worker thread using OffscreenCanvas.\r\n * Once instance of this class can only be used to play a single animation. If you want to play multiple animations, create a new instance for each animation.\r\n */\r\nexport class LottiePlayer {\r\n    private _playing: boolean = false;\r\n    private _disposed: boolean = false;\r\n    private _worker: Nullable<Worker> = null;\r\n    private _canvas: Nullable<HTMLCanvasElement> = null;\r\n    private _resizeObserver: Nullable<ResizeObserver> = null;\r\n\r\n    private readonly _container: HTMLDivElement;\r\n    private readonly _animationFile: string;\r\n    private readonly _configuration: Partial<AnimationConfiguration>;\r\n\r\n    /**\r\n     * Creates a new instance of the LottiePlayer.\r\n     * @param container The HTMLDivElement to create the canvas in and render the animation on.\r\n     * @param animationFile The URL of the Lottie animation file to be played.\r\n     * @param configuration Optional configuration object to customize the animation playback.\r\n     */\r\n    public constructor(container: HTMLDivElement, animationFile: string, configuration?: Partial<AnimationConfiguration>) {\r\n        this._container = container;\r\n        this._animationFile = animationFile;\r\n        this._configuration = configuration ?? {};\r\n    }\r\n\r\n    /**\r\n     * Loads and plays a lottie animation.\r\n     * @returns True if the animation is successfully set up to play, false if the animation couldn't play.\r\n     */\r\n    public playAnimation(): boolean {\r\n        if (this._playing || this._disposed) {\r\n            return false;\r\n        }\r\n\r\n        if (\"OffscreenCanvas\" in window) {\r\n            // Create the canvas element\r\n            this._canvas = document.createElement(\"canvas\");\r\n            this._canvas.width = this._container.clientWidth;\r\n            this._canvas.height = this._container.clientHeight;\r\n\r\n            // Style the canvas to fill the container\r\n            this._canvas.style.width = \"100%\";\r\n            this._canvas.style.height = \"100%\";\r\n            this._canvas.style.display = \"block\";\r\n\r\n            // Append the canvas to the container\r\n            this._container.appendChild(this._canvas);\r\n\r\n            const offscreen = this._canvas.transferControlToOffscreen();\r\n\r\n            this._worker = new Worker(new URL(\"./worker.ts\", import.meta.url), { type: \"module\" });\r\n            this._worker.onmessage = (evt: MessageEvent) => {\r\n                if (evt.data.animationWidth && evt.data.animationHeight && this._canvas) {\r\n                    this._canvas.style.width = `${evt.data.animationWidth}px`;\r\n                    this._canvas.style.height = `${evt.data.animationHeight}px`;\r\n                }\r\n            };\r\n\r\n            this._worker.postMessage({ canvas: offscreen, file: this._animationFile, config: this._configuration }, [offscreen]);\r\n            this._playing = true;\r\n\r\n            window.addEventListener(\"resize\", this._onWindowResize);\r\n            window.addEventListener(\"beforeunload\", this._onBeforeUnload);\r\n\r\n            if (\"ResizeObserver\" in window) {\r\n                this._resizeObserver = new ResizeObserver(() => {\r\n                    if (this._disposed || !this._canvas || !this._worker) {\r\n                        return;\r\n                    }\r\n\r\n                    const w = this._canvas.clientWidth;\r\n                    const h = this._canvas.clientHeight;\r\n\r\n                    this._worker.postMessage({ width: w, height: h });\r\n                });\r\n\r\n                this._resizeObserver.observe(this._container);\r\n            }\r\n\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disposes the LottiePlayer instance, cleaning up resources and event listeners.\r\n     */\r\n    public dispose(): void {\r\n        window.removeEventListener(\"resize\", this._onWindowResize);\r\n        window.removeEventListener(\"beforeunload\", this._onBeforeUnload);\r\n\r\n        if (this._resizeObserver) {\r\n            this._resizeObserver.disconnect();\r\n            this._resizeObserver = null;\r\n        }\r\n\r\n        this._onBeforeUnload();\r\n\r\n        if (this._canvas) {\r\n            this._container.removeChild(this._canvas);\r\n            this._canvas = null;\r\n        }\r\n\r\n        this._disposed = true;\r\n    }\r\n\r\n    private _onWindowResize = () => {\r\n        if (this._disposed || !this._canvas || !this._worker) {\r\n            return;\r\n        }\r\n\r\n        const w = this._canvas.clientWidth;\r\n        const h = this._canvas.clientHeight;\r\n\r\n        this._worker.postMessage({ width: w, height: h });\r\n    };\r\n\r\n    private _onBeforeUnload = () => {\r\n        this._worker?.terminate();\r\n        this._worker = null;\r\n    };\r\n}\r\n"]}