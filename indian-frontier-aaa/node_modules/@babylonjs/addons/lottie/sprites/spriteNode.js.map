{"version":3,"file":"spriteNode.js","sourceRoot":"","sources":["../../../../../dev/addons/src/lottie/sprites/spriteNode.ts"],"names":[],"mappings":"AAIA,OAAO,EAAE,IAAI,EAAE,MAAM,mBAAmB,CAAC;AAEzC;;GAEG;AACH,MAAM,SAAS,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;AAEjC;;GAEG;AACH,MAAM,OAAO,UAAW,SAAQ,IAAI;IAOhC;;;;;;;;;;OAUG;IACH,YACI,EAAU,EACV,uBAAgC,EAChC,MAAkB,EAClB,QAA0B,EAC1B,QAAyB,EACzB,KAAuB,EACvB,OAAwB,EACxB,MAAa;QAEb,KAAK,CAAC,EAAE,EAAE,uBAAuB,EAAE,QAAQ,EAAE,QAAQ,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;QAvB3E,eAAU,GAAG,IAAI,CAAC;QAyBtB,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC,KAAK,CAAC;QACnC,IAAI,CAAC,eAAe,GAAG,MAAM,CAAC,MAAM,CAAC;QAErC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACzB,CAAC;IAED;;;;;;OAMG;IACa,MAAM,CAAC,KAAa,EAAE,eAAe,GAAG,KAAK,EAAE,OAAO,GAAG,KAAK;QAC1E,MAAM,OAAO,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,eAAe,EAAE,OAAO,CAAC,IAAI,IAAI,CAAC,UAAU,CAAC;QACjF,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QAExB,IAAI,OAAO,EAAE,CAAC;YACV,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YAE9E,kDAAkD;YAClD,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC,CAAC,CAAC;YACvD,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,IAAI,CAAC,eAAe,GAAG,SAAS,CAAC,CAAC,CAAC;YAEzD,WAAW;YACX,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,QAAQ,CAAC;QAClC,CAAC;QAED,UAAU;QACV,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC;QAEpC,OAAO,OAAO,CAAC;IACnB,CAAC;CACJ","sourcesContent":["import type { ThinSprite } from \"core/Sprites/thinSprite\";\r\n\r\nimport type { ScalarProperty, Vector2Property } from \"../lottie/parsedTypes\";\r\n\r\nimport { Node } from \"../rendering/node\";\r\n\r\n/**\r\n * Temporary scale vector used during sprite updates for matrix decomposition.\r\n */\r\nconst TempScale = { x: 1, y: 1 };\r\n\r\n/**\r\n * Represents a sprite in the scene graph.\r\n */\r\nexport class SpriteNode extends Node {\r\n    private _sprite: ThinSprite;\r\n    private _originalWidth: number;\r\n    private _originalHeight: number;\r\n\r\n    private _firstTime = true;\r\n\r\n    /**\r\n     * Creates a new SpriteNode instance.\r\n     * @param id Unique identifier for the sprite node.\r\n     * @param ignoreOpacityAnimations If there are no animations on opacity, mark this as true to ignore and optimize CPU usage.\r\n     * @param sprite The sprite associated with this node.\r\n     * @param position The position of the sprite in the scene.\r\n     * @param rotation The rotation of the sprite in degrees.\r\n     * @param scale The scale of the sprite in the scene.\r\n     * @param opacity The opacity of the sprite.\r\n     * @param parent The parent node in the scene graph.\r\n     */\r\n    public constructor(\r\n        id: string,\r\n        ignoreOpacityAnimations: boolean,\r\n        sprite: ThinSprite,\r\n        position?: Vector2Property,\r\n        rotation?: ScalarProperty,\r\n        scale?: Vector2Property,\r\n        opacity?: ScalarProperty,\r\n        parent?: Node\r\n    ) {\r\n        super(id, ignoreOpacityAnimations, position, rotation, scale, opacity, parent);\r\n\r\n        this._sprite = sprite;\r\n        this._originalWidth = sprite.width;\r\n        this._originalHeight = sprite.height;\r\n\r\n        this._isShape = true;\r\n    }\r\n\r\n    /**\r\n     * Updates the node's properties based on the current frame of the animation.\r\n     * @param frame Frame number we are playing in the animation.\r\n     * @param isParentUpdated Whether the parent node has been updated.\r\n     * @param isReset Whether the node is being reset.\r\n     * @returns True if the node was updated, false otherwise.\r\n     */\r\n    public override update(frame: number, isParentUpdated = false, isReset = false): boolean {\r\n        const isDirty = super.update(frame, isParentUpdated, isReset) || this._firstTime;\r\n        this._firstTime = false;\r\n\r\n        if (isDirty) {\r\n            const rotation = this.worldMatrix.decompose(TempScale, this._sprite.position);\r\n\r\n            // Apply scaling to the original sprite dimensions\r\n            this._sprite.width = this._originalWidth * TempScale.x;\r\n            this._sprite.height = this._originalHeight * TempScale.y;\r\n\r\n            // Rotation\r\n            this._sprite.angle = rotation;\r\n        }\r\n\r\n        // Opacity\r\n        this._sprite.color.a = this.opacity;\r\n\r\n        return isDirty;\r\n    }\r\n}\r\n"]}