{"version":3,"file":"spritePacker.js","sourceRoot":"","sources":["../../../../../dev/addons/src/lottie/sprites/spritePacker.ts"],"names":[],"mappings":"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","sourcesContent":["import \"core/Engines/Extensions/engine.dynamicTexture\";\r\n\r\nimport type { ThinEngine } from \"core/Engines/thinEngine\";\r\nimport type { InternalTexture } from \"core/Materials/Textures/internalTexture\";\r\nimport type { IVector2Like } from \"core/Maths/math.like\";\r\nimport { ThinTexture } from \"core/Materials/Textures/thinTexture\";\r\n\r\nimport type { RawBezier, RawFillShape, RawGradientFillShape, RawPathShape, RawRectangleShape, RawGroupShape } from \"../lottie/rawTypes\";\r\n\r\nimport type { BoundingBox } from \"../maths/boundingBox\";\r\nimport { GetBoundingBox } from \"../maths/boundingBox\";\r\n\r\nimport type { AnimationConfiguration } from \"../lottiePlayer\";\r\n\r\n/**\r\n * Information about a sprite in the sprite atlas.\r\n */\r\nexport type SpriteAtlasInfo = {\r\n    /**\r\n     * Offset in the x axis of the sprite in the atlas.\r\n     * Normalized between 0 and 1, left to right.\r\n     */\r\n    uOffset: number;\r\n    /**\r\n     * Offset in the y axis of the sprite in the atlas.\r\n     * Normalized between 0 and 1, top to bottom.\r\n     */\r\n    vOffset: number;\r\n\r\n    /**\r\n     * Width of the sprite in the atlas.\r\n     * In pixels.\r\n     */\r\n    cellWidth: number;\r\n\r\n    /**\r\n     * Height of the sprite in the atlas.\r\n     * In pixels.\r\n     */\r\n    cellHeight: number;\r\n\r\n    /**\r\n     * Width of the sprite in the screen.\r\n     * In pixels.\r\n     */\r\n    widthPx: number;\r\n    /**\r\n     * Height of the sprite in the screen.\r\n     * In pixels.\r\n     */\r\n    heightPx: number;\r\n\r\n    /**\r\n     * X coordinate of the center of the sprite bounding box, used for final positioning in the screen\r\n     */\r\n    centerX: number;\r\n\r\n    /**\r\n     * Y coordinate of the center of the sprite bounding box, used for final positioning in the screen\r\n     */\r\n    centerY: number;\r\n};\r\n\r\n/**\r\n * Information about a gradient stop.\r\n * Used for gradient fills when adding vector shapes to the sprite atlas.\r\n */\r\ntype GradientStop = {\r\n    offset: number;\r\n    color: string;\r\n};\r\n\r\n/**\r\n * SpritePacker is a class that handles the packing of sprites into a texture atlas.\r\n */\r\nexport class SpritePacker {\r\n    private readonly _engine: ThinEngine;\r\n    private readonly _configuration: AnimationConfiguration;\r\n\r\n    private _spritesCanvas: OffscreenCanvas;\r\n    private _spritesCanvasContext: OffscreenCanvasRenderingContext2D;\r\n    private readonly _spritesInternalTexture: InternalTexture;\r\n    private readonly _spritesTexture: ThinTexture;\r\n\r\n    private _isDirty: boolean; // Indicates if the sprite atlas needs to be updated\r\n    private _currentX: number;\r\n    private _currentY: number;\r\n    private _maxRowHeight: number; // Keep track of the maximum height of the current row to handle sprite packing correctly\r\n\r\n    // Variable to avoid allocations\r\n    private _spriteAtlasInfo: SpriteAtlasInfo;\r\n\r\n    /**\r\n     * Gets the texture atlas that contains all the sprites packed by this SpritePacker.\r\n     * @returns The texture atlas containing the sprites.\r\n     */\r\n    public get texture(): ThinTexture {\r\n        return this._spritesTexture;\r\n    }\r\n\r\n    /**\r\n     * Creates a new instance of SpritePacker.\r\n     * @param engine Engine that will render the sprites.\r\n     * @param configuration Configuration options for the sprite packer.\r\n     */\r\n    public constructor(engine: ThinEngine, configuration: AnimationConfiguration) {\r\n        this._engine = engine;\r\n        this._configuration = configuration;\r\n        this._isDirty = false;\r\n        this._currentX = 0;\r\n        this._currentY = 0;\r\n        this._maxRowHeight = 0;\r\n\r\n        this._spritesCanvas = new OffscreenCanvas(this._configuration.spriteAtlasSize, this._configuration.spriteAtlasSize);\r\n        this._spritesCanvasContext = this._spritesCanvas.getContext(\"2d\") as OffscreenCanvasRenderingContext2D;\r\n\r\n        this._spritesInternalTexture = this._engine.createDynamicTexture(this._configuration.spriteAtlasSize, this._configuration.spriteAtlasSize, false, 2); // Linear filtering\r\n        this._engine.updateDynamicTexture(this._spritesInternalTexture, this._spritesCanvas, false);\r\n\r\n        this._spritesTexture = new ThinTexture(this._spritesInternalTexture);\r\n        this._spritesTexture.wrapU = 0; // Disable wrapping\r\n        this._spritesTexture.wrapV = 0; // Disable wrapping\r\n\r\n        this._spriteAtlasInfo = {\r\n            uOffset: 0,\r\n            vOffset: 0,\r\n            cellWidth: 0,\r\n            cellHeight: 0,\r\n            widthPx: 0,\r\n            heightPx: 0,\r\n            centerX: 0,\r\n            centerY: 0,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Adds a vector shape that comes from lottie data to the sprite atlas.\r\n     * @param rawGroup The raw group shape to add to the atlas.\r\n     * @param scalingFactor The scaling factor to apply to the shape.\r\n     * @returns The information on how to find the sprite in the atlas.\r\n     */\r\n    public addLottieShape(rawGroup: RawGroupShape, scalingFactor: IVector2Like): SpriteAtlasInfo {\r\n        const boundingBox = GetBoundingBox(rawGroup);\r\n        this._spriteAtlasInfo.cellWidth = boundingBox.width * scalingFactor.x;\r\n        this._spriteAtlasInfo.cellHeight = boundingBox.height * scalingFactor.y;\r\n\r\n        this._spriteAtlasInfo.centerX = boundingBox.centerX;\r\n        this._spriteAtlasInfo.centerY = boundingBox.centerY;\r\n\r\n        // Check if the sprite fits in the current row\r\n        if (this._currentX + this._spriteAtlasInfo.cellWidth > this._configuration.spriteAtlasSize) {\r\n            this._currentX = 0;\r\n            this._currentY += this._maxRowHeight + this._configuration.gapSize; // Add a gap between sprites to avoid bleeding\r\n            this._maxRowHeight = 0;\r\n        }\r\n\r\n        // Normalize the x/y offsets in texture coordinates (0 to 1)\r\n        this._spriteAtlasInfo.uOffset = this._currentX / this._configuration.spriteAtlasSize;\r\n        this._spriteAtlasInfo.vOffset = this._currentY / this._configuration.spriteAtlasSize;\r\n\r\n        this._drawVectorShape(rawGroup, boundingBox, scalingFactor);\r\n\r\n        this._currentX += this._spriteAtlasInfo.cellWidth + this._configuration.gapSize; // Add a gap between sprites to avoid bleeding\r\n        this._maxRowHeight = Math.max(this._maxRowHeight, this._spriteAtlasInfo.cellHeight);\r\n\r\n        this._spriteAtlasInfo.widthPx = boundingBox.width;\r\n        this._spriteAtlasInfo.heightPx = boundingBox.height;\r\n\r\n        this._isDirty = true;\r\n\r\n        return this._spriteAtlasInfo;\r\n    }\r\n\r\n    /**\r\n     * Updates the internal atlas texture with the information that has been added to the SpritePacker.\r\n     */\r\n    public updateAtlasTexture(): void {\r\n        if (!this._isDirty) {\r\n            return; // No need to update if nothing has changed\r\n        }\r\n\r\n        // Update the internal texture with the new canvas content\r\n        this._engine.updateDynamicTexture(this._spritesInternalTexture, this._spritesCanvas, false);\r\n        this._isDirty = false;\r\n    }\r\n\r\n    /**\r\n     * Releases the canvas and its context to allow garbage collection.\r\n     */\r\n    public releaseCanvas(): void {\r\n        this._spritesCanvasContext = undefined as any; // Clear the context to allow garbage collection\r\n        this._spritesCanvas = undefined as any; // Clear the canvas to allow garbage collection\r\n    }\r\n\r\n    private _drawVectorShape(rawGroup: RawGroupShape, boundingBox: BoundingBox, scalingFactor: IVector2Like): void {\r\n        this._spritesCanvasContext.save();\r\n\r\n        this._spritesCanvasContext.translate(this._currentX, this._currentY);\r\n        this._spritesCanvasContext.scale(scalingFactor.x, scalingFactor.y);\r\n\r\n        this._spritesCanvasContext.beginPath();\r\n        if (rawGroup.it) {\r\n            for (let i = 0; i < rawGroup.it.length; i++) {\r\n                const shape = rawGroup.it[i];\r\n                switch (shape.ty) {\r\n                    case \"rc\":\r\n                        this._drawRectangle(shape as RawRectangleShape);\r\n                        break;\r\n                    case \"sh\":\r\n                        this._drawPath(shape as RawPathShape, boundingBox);\r\n                        break;\r\n                    case \"fl\":\r\n                        this._drawFill(shape as RawFillShape);\r\n                        break;\r\n                    case \"gf\":\r\n                        this._drawGradientFill(shape as RawGradientFillShape, boundingBox);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n\r\n        this._spritesCanvasContext.restore();\r\n    }\r\n\r\n    private _drawRectangle(shape: RawRectangleShape): void {\r\n        const size = shape.s.k as number[];\r\n        const radius = shape.r.k as number;\r\n\r\n        if (radius <= 0) {\r\n            this._spritesCanvasContext.rect(0, 0, size[0], size[1]);\r\n        } else {\r\n            this._spritesCanvasContext.roundRect(0, 0, size[0], size[1], radius);\r\n        }\r\n    }\r\n\r\n    private _drawPath(shape: RawPathShape, boundingBox: BoundingBox): void {\r\n        const pathData = shape.ks.k as RawBezier;\r\n        const xTranslate = boundingBox.width / 2 - boundingBox.centerX;\r\n        const yTranslate = boundingBox.height / 2 - boundingBox.centerY;\r\n\r\n        const vertices = pathData.v;\r\n        const inTangents = pathData.i;\r\n        const outTangents = pathData.o;\r\n\r\n        if (vertices.length > 0) {\r\n            this._spritesCanvasContext.moveTo(vertices[0][0] + xTranslate, vertices[0][1] + yTranslate);\r\n\r\n            for (let i = 0; i < vertices.length - 1; i++) {\r\n                const start = vertices[i];\r\n                const end = vertices[i + 1];\r\n                const outTangent = outTangents[i];\r\n                const inTangent = inTangents[i + 1];\r\n\r\n                this._spritesCanvasContext.bezierCurveTo(\r\n                    start[0] + xTranslate + outTangent[0],\r\n                    start[1] + yTranslate + outTangent[1],\r\n                    end[0] + xTranslate + inTangent[0],\r\n                    end[1] + yTranslate + inTangent[1],\r\n                    end[0] + xTranslate,\r\n                    end[1] + yTranslate\r\n                );\r\n            }\r\n\r\n            if (pathData.c) {\r\n                // Close path with curve from last to first point\r\n                const start = vertices[vertices.length - 1];\r\n                const end = vertices[0];\r\n                const outTangent = outTangents[vertices.length - 1];\r\n                const inTangent = inTangents[0];\r\n\r\n                this._spritesCanvasContext.bezierCurveTo(\r\n                    start[0] + xTranslate + outTangent[0],\r\n                    start[1] + yTranslate + outTangent[1],\r\n                    end[0] + xTranslate + inTangent[0],\r\n                    end[1] + yTranslate + inTangent[1],\r\n                    end[0] + xTranslate,\r\n                    end[1] + yTranslate\r\n                );\r\n\r\n                this._spritesCanvasContext.closePath();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _drawFill(fill: RawFillShape): void {\r\n        const color = this._lottieColorToCSSColor(fill.c.k as number[], (fill.o.k as number) / 100);\r\n        this._spritesCanvasContext.fillStyle = color;\r\n\r\n        this._spritesCanvasContext.fill();\r\n    }\r\n\r\n    private _drawGradientFill(fill: RawGradientFillShape, boundingBox: BoundingBox): void {\r\n        switch (fill.t) {\r\n            case 1: {\r\n                this._drawLinearGradientFill(fill, boundingBox);\r\n                break;\r\n            }\r\n            case 2: {\r\n                this._drawRadialGradientFill(fill, boundingBox);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _drawLinearGradientFill(fill: RawGradientFillShape, boundingBox: BoundingBox): void {\r\n        const xTranslate = boundingBox.width / 2 - boundingBox.centerX;\r\n        const yTranslate = boundingBox.height / 2 - boundingBox.centerY;\r\n\r\n        // Create the gradient\r\n        const startPoint = fill.s.k as number[];\r\n        const endPoint = fill.e.k as number[];\r\n        const gradient = this._spritesCanvasContext.createLinearGradient(\r\n            startPoint[0] + xTranslate,\r\n            startPoint[1] + yTranslate,\r\n            endPoint[0] + xTranslate,\r\n            endPoint[1] + yTranslate\r\n        );\r\n\r\n        this._addColorStops(gradient, fill);\r\n\r\n        this._spritesCanvasContext.fillStyle = gradient;\r\n        this._spritesCanvasContext.fill();\r\n    }\r\n\r\n    private _drawRadialGradientFill(fill: RawGradientFillShape, boundingBox: BoundingBox): void {\r\n        const xTranslate = boundingBox.width / 2 - boundingBox.centerX;\r\n        const yTranslate = boundingBox.height / 2 - boundingBox.centerY;\r\n\r\n        // Create the gradient\r\n        const startPoint = fill.s.k as number[];\r\n        const endPoint = fill.e.k as number[];\r\n\r\n        const gradient = this._spritesCanvasContext.createRadialGradient(\r\n            startPoint[0] + xTranslate,\r\n            startPoint[1] + yTranslate,\r\n            0,\r\n            endPoint[0] + xTranslate,\r\n            endPoint[1] + yTranslate,\r\n            Math.hypot(endPoint[0] - startPoint[0], endPoint[1] - startPoint[1]) // End radius\r\n        );\r\n\r\n        this._addColorStops(gradient, fill);\r\n\r\n        this._spritesCanvasContext.fillStyle = gradient;\r\n        this._spritesCanvasContext.fill();\r\n    }\r\n\r\n    private _addColorStops(gradient: CanvasGradient, fill: RawGradientFillShape): void {\r\n        const stops = fill.g.p;\r\n        const rawColors = fill.g.k.k;\r\n\r\n        let stopsData: GradientStop[] | undefined = undefined;\r\n        if (rawColors.length / stops === 4) {\r\n            stopsData = this._gradientColorsToCssColor(rawColors, stops, false);\r\n        } else if (rawColors.length / stops === 6) {\r\n            stopsData = this._gradientColorsToCssColor(rawColors, stops, true);\r\n        } else {\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < stops; i++) {\r\n            gradient.addColorStop(stopsData[i].offset, stopsData[i].color);\r\n        }\r\n    }\r\n\r\n    private _gradientColorsToCssColor(colors: number[], stops: number, hasAlpha: boolean): GradientStop[] {\r\n        const skipElement = hasAlpha ? 0 : 1;\r\n        const result: GradientStop[] = [];\r\n        for (let i = 0; i < stops; i++) {\r\n            const index = i * 4;\r\n            result.push({\r\n                offset: colors[index],\r\n                color: this._lottieColorToCSSColor(colors.slice(index + skipElement, index + 4), 1),\r\n            });\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private _lottieColorToCSSColor(color: number[], opacity: number): string {\r\n        if (color.length !== 3 && color.length !== 4) {\r\n            return \"rgba(0, 0, 0, 1)\"; // Default to black if invalid\r\n        }\r\n\r\n        const r = Math.round(color[0] * 255);\r\n        const g = Math.round(color[1] * 255);\r\n        const b = Math.round(color[2] * 255);\r\n        const a = (color[3] || 1) * opacity;\r\n\r\n        return `rgba(${r}, ${g}, ${b}, ${a})`;\r\n    }\r\n}\r\n"]}