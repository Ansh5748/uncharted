{"version":3,"file":"matrix.js","sourceRoot":"","sources":["../../../../../dev/addons/src/lottie/maths/matrix.ts"],"names":[],"mappings":"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","sourcesContent":["import type { IMatrixLike, IVector2Like } from \"core/Maths/math.like\";\r\nimport type { Tuple } from \"core/types\";\r\n\r\n/**\r\n * Represents a Babylon.js thin version of a Matrix\r\n * We are only exposing what we truly need in the scope of\r\n * the Lottie Renderer project preventing the dependency on the full\r\n * Babylon.js math system.\r\n */\r\nexport class ThinMatrix implements IMatrixLike {\r\n    /**\r\n     * Prevents global conflicts on update as shader programs are shared.\r\n     */\r\n    private static _UPDATE_FLAG_SEED = 0;\r\n\r\n    /**\r\n     * Current update flag used to know whether a Matrix has changed since previous render or not.\r\n     * This helps identifying if a Matrix needs to be\r\n     * uploaded to a shader program.\r\n     */\r\n    public updateFlag = -1;\r\n\r\n    private readonly _data: Float32Array;\r\n\r\n    /**\r\n     * Creates a new ThinMatrix instance.\r\n     */\r\n    public constructor() {\r\n        this._data = new Float32Array(16);\r\n    }\r\n\r\n    /**\r\n     * Set the matrix values.\r\n     * @param m11 Value for row 1, column 1\r\n     * @param m12 Value for row 1, column 2\r\n     * @param m13 Value for row 1, column 3\r\n     * @param m14 Value for row 1, column 4\r\n     * @param m21 Value for row 2, column 1\r\n     * @param m22 Value for row 2, column 2\r\n     * @param m23 Value for row 2, column 3\r\n     * @param m24 Value for row 2, column 4\r\n     * @param m31 Value for row 3, column 1\r\n     * @param m32 Value for row 3, column 2\r\n     * @param m33 Value for row 3, column 3\r\n     * @param m34 Value for row 3, column 4\r\n     * @param m41 Value for row 4, column 1\r\n     * @param m42 Value for row 4, column 2\r\n     * @param m43 Value for row 4, column 3\r\n     * @param m44 Value for row 4, column 4\r\n     * @returns The updated ThinMatrix instance\r\n     */\r\n    public setValues(\r\n        m11: number,\r\n        m12: number,\r\n        m13: number,\r\n        m14: number,\r\n        m21: number,\r\n        m22: number,\r\n        m23: number,\r\n        m24: number,\r\n        m31: number,\r\n        m32: number,\r\n        m33: number,\r\n        m34: number,\r\n        m41: number,\r\n        m42: number,\r\n        m43: number,\r\n        m44: number\r\n    ): ThinMatrix {\r\n        const m = this._data;\r\n        m[0] = m11;\r\n        m[1] = m12;\r\n        m[2] = m13;\r\n        m[3] = m14;\r\n        m[4] = m21;\r\n        m[5] = m22;\r\n        m[6] = m23;\r\n        m[7] = m24;\r\n        m[8] = m31;\r\n        m[9] = m32;\r\n        m[10] = m33;\r\n        m[11] = m34;\r\n        m[12] = m41;\r\n        m[13] = m42;\r\n        m[14] = m43;\r\n        m[15] = m44;\r\n\r\n        this.updateFlag = ThinMatrix._UPDATE_FLAG_SEED++;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Set the matrix to an identity matrix.\r\n     * @returns The updated ThinMatrix instance\r\n     */\r\n    public identity(): ThinMatrix {\r\n        this.setValues(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Stores a left-handed orthographic projection into a given matrix\r\n     * @param left defines the viewport left coordinate\r\n     * @param right defines the viewport right coordinate\r\n     * @param bottom defines the viewport bottom coordinate\r\n     * @param top defines the viewport top coordinate\r\n     * @param znear defines the near clip plane\r\n     * @param zfar defines the far clip plane\r\n     * @returns The updated ThinMatrix instance\r\n     */\r\n    public orthoOffCenterLeftHanded(left: number, right: number, bottom: number, top: number, znear: number, zfar: number): ThinMatrix {\r\n        const n = znear;\r\n        const f = zfar;\r\n\r\n        const a = 2.0 / (right - left);\r\n        const b = 2.0 / (top - bottom);\r\n        const c = 2.0 / (f - n);\r\n        const d = -(f + n) / (f - n);\r\n        const i0 = (left + right) / (left - right);\r\n        const i1 = (top + bottom) / (bottom - top);\r\n\r\n        this.setValues(a, 0.0, 0.0, 0.0, 0.0, b, 0.0, 0.0, 0.0, 0.0, c, 0.0, i0, i1, d, 1.0);\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets a matrix to a value composed by merging scale (vector2), rotation (roll around z) and translation (vector2)\r\n     * This only updates the parts of the matrix that are used for 2D transformations.\r\n     * @param scale defines the scale vector\r\n     * @param roll defines the rotation around z\r\n     * @param translation defines the translation vector\r\n     * @returns the updated ThinMatrix instance\r\n     */\r\n    public compose(scale: IVector2Like, roll: number, translation: IVector2Like): ThinMatrix {\r\n        // Produces a quaternion from Euler angles in the z-y-x orientation (Tait-Bryan angles)\r\n        const halfRoll = roll * 0.5;\r\n        const z = Math.sin(halfRoll),\r\n            w = Math.cos(halfRoll);\r\n\r\n        const z2 = z + z;\r\n        const zz = z * z2;\r\n        const wz = w * z2;\r\n\r\n        const sx = scale.x,\r\n            sy = scale.y;\r\n\r\n        const m = this._data;\r\n        m[0] = (1 - zz) * sx;\r\n        m[1] = wz * sx;\r\n\r\n        m[4] = -wz * sy;\r\n        m[5] = (1 - zz) * sy;\r\n\r\n        m[12] = translation.x;\r\n        m[13] = translation.y;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets the current matrix with the multiplication result of the current Matrix and the given one\r\n     * This only updates the parts of the matrix that are used for 2D transformations.\r\n     * @param other defines the second operand\r\n     * @param output the matrix to store the result in\r\n     * @returns the current matrix\r\n     */\r\n    public multiplyToRef(other: ThinMatrix, output: ThinMatrix): ThinMatrix {\r\n        const m = this._data;\r\n        const otherM = other._data;\r\n\r\n        // Only calculate the values we actually use (2D transform)\r\n        const tm0 = m[0],\r\n            tm1 = m[1],\r\n            tm4 = m[4],\r\n            tm5 = m[5];\r\n        const tm12 = m[12],\r\n            tm13 = m[13];\r\n\r\n        const om0 = otherM[0],\r\n            om1 = otherM[1];\r\n        const om4 = otherM[4],\r\n            om5 = otherM[5];\r\n        const om12 = otherM[12],\r\n            om13 = otherM[13];\r\n\r\n        // Only update the 2D transformation parts\r\n        output._data[0] = tm0 * om0 + tm1 * om4;\r\n        output._data[1] = tm0 * om1 + tm1 * om5;\r\n        output._data[4] = tm4 * om0 + tm5 * om4;\r\n        output._data[5] = tm4 * om1 + tm5 * om5;\r\n        output._data[12] = tm12 * om0 + tm13 * om4 + om12;\r\n        output._data[13] = tm12 * om1 + tm13 * om5 + om13;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Returns the matrix data array.\r\n     * @returns The matrix data\r\n     */\r\n    public asArray(): Tuple<number, 16> {\r\n        return this._data as any as Tuple<number, 16>;\r\n    }\r\n\r\n    /**\r\n     * Decomposes the matrix into scale, rotation, and translation.\r\n     * @param scale Scale vector to store the scale values\r\n     * @param translation Translation vector to store the translation values\r\n     * @returns The rotation in radians\r\n     */\r\n    public decompose(scale: IVector2Like, translation: IVector2Like): number {\r\n        const m00 = this._data[0]; // scaleX * cos(θ)\r\n        const m01 = this._data[1]; // -scaleY * sin(θ)\r\n        const m10 = this._data[4]; // scaleX * sin(θ)\r\n        const m11 = this._data[5]; // scaleY * cos(θ)\r\n\r\n        // Extract scale\r\n        scale.x = Math.hypot(m00, m10); // sqrt(m00² + m10²)\r\n        scale.y = Math.hypot(m01, m11); // sqrt(m01² + m11²)\r\n\r\n        // Extract rotation (assumes uniform scaling or affine 2D)\r\n        const rotation = Math.atan2(m10, m00); // θ from the first column\r\n\r\n        // Extract the translation\r\n        translation.x = this._data[12];\r\n        translation.y = this._data[13];\r\n\r\n        return rotation;\r\n    }\r\n}\r\n"]}