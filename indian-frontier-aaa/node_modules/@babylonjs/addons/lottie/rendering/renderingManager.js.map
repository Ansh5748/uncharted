{"version":3,"file":"renderingManager.js","sourceRoot":"","sources":["../../../../../dev/addons/src/lottie/rendering/renderingManager.ts"],"names":[],"mappings":"AAAA,oEAAsD;AACtD,mDAAqC;AACrC,qDAAuC;AAKvC,OAAO,EAAE,cAAc,EAAE,kDAAoC;AAM7D;;GAEG;AACH,MAAM,OAAO,gBAAgB;IAOzB;;;;;OAKG;IACH,YAAmB,MAAkB,EAAE,aAA0B,EAAE,aAAqC;QA+ChG,wBAAmB,GAAG,GAAS,EAAE;YACrC,wDAAwD;YACxD,gEAAgE;QACpE,CAAC,CAAC;QAjDE,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,eAAe,GAAG,aAAa,CAAC;QACrC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;QACnB,IAAI,CAAC,cAAc,GAAG,aAAa,CAAC;QAEpC,IAAI,CAAC,gBAAgB,GAAG,IAAI,cAAc,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;QACjG,IAAI,CAAC,gBAAgB,CAAC,iBAAiB,GAAG,IAAI,CAAC;QAC/C,IAAI,CAAC,gBAAgB,CAAC,cAAc,GAAG,KAAK,CAAC;QAC7C,IAAI,CAAC,gBAAgB,CAAC,UAAU,GAAG,KAAK,CAAC;QACzC,IAAI,CAAC,gBAAgB,CAAC,OAAO,GAAG,IAAI,CAAC,eAAe,CAAC;IACzD,CAAC;IAED;;;OAGG;IACI,SAAS,CAAC,MAAkB;QAC/B,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC/B,CAAC;IAED;;OAEG;IACI,KAAK;QACR,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;IAC5C,CAAC;IAED;;;;OAIG;IACI,MAAM,CAAC,WAAuB,EAAE,gBAA4B;QAC/D,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,eAAe,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;QAC5E,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,EAAE,WAAW,EAAE,gBAAgB,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;IAC5G,CAAC;IAED;;OAEG;IACI,OAAO;QACV,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,gBAAgB,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,gDAAgD;QACtF,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC;IACpC,CAAC;CAMJ","sourcesContent":["import \"core/Engines/Extensions/engine.dynamicBuffer\";\r\nimport \"core/Shaders/sprites.vertex\";\r\nimport \"core/Shaders/sprites.fragment\";\r\n\r\nimport type { ThinEngine } from \"core/Engines/thinEngine\";\r\nimport type { ThinTexture } from \"core/Materials/Textures/thinTexture\";\r\nimport type { ThinSprite } from \"core/Sprites/thinSprite\";\r\nimport { SpriteRenderer } from \"core/Sprites/spriteRenderer\";\r\n\r\nimport type { ThinMatrix } from \"../maths/matrix\";\r\n\r\nimport type { AnimationConfiguration } from \"../lottiePlayer\";\r\n\r\n/**\r\n * Represents all the sprites from the animation and manages their rendering.\r\n */\r\nexport class RenderingManager {\r\n    private readonly _engine: ThinEngine;\r\n    private readonly _spritesRenderer: SpriteRenderer;\r\n    private readonly _spritesTexture: ThinTexture;\r\n    private _sprites: ThinSprite[];\r\n    private readonly _configuration: AnimationConfiguration;\r\n\r\n    /**\r\n     * Creates a new instance of the RenderingManager.\r\n     * @param engine ThinEngine instance used for rendering.\r\n     * @param spriteTexture The texture atlas containing the sprites.\r\n     * @param configuration Configuration options for the rendering manager.\r\n     */\r\n    public constructor(engine: ThinEngine, spriteTexture: ThinTexture, configuration: AnimationConfiguration) {\r\n        this._engine = engine;\r\n        this._spritesTexture = spriteTexture;\r\n        this._sprites = [];\r\n        this._configuration = configuration;\r\n\r\n        this._spritesRenderer = new SpriteRenderer(this._engine, this._configuration.spritesCapacity, 0);\r\n        this._spritesRenderer.disableDepthWrite = true;\r\n        this._spritesRenderer.autoResetAlpha = false;\r\n        this._spritesRenderer.fogEnabled = false;\r\n        this._spritesRenderer.texture = this._spritesTexture;\r\n    }\r\n\r\n    /**\r\n     * Adds a sprite to the rendering manager.\r\n     * @param sprite Sprite to add to the rendering manager.\r\n     */\r\n    public addSprite(sprite: ThinSprite): void {\r\n        this._sprites.push(sprite);\r\n    }\r\n\r\n    /**\r\n     * Prepares the rendering manager for rendering.\r\n     */\r\n    public ready(): void {\r\n        this._sprites = this._sprites.reverse();\r\n    }\r\n\r\n    /**\r\n     * Renders all the sprites in the rendering manager.\r\n     * @param worldMatrix World matrix to apply to the sprites.\r\n     * @param projectionMatrix Projection matrix to apply to the sprites.\r\n     */\r\n    public render(worldMatrix: ThinMatrix, projectionMatrix: ThinMatrix): void {\r\n        this._engine.clear(this._configuration.backgroundColor, true, false, false);\r\n        this._spritesRenderer.render(this._sprites, 0, worldMatrix, projectionMatrix, this._customSpriteUpdate);\r\n    }\r\n\r\n    /**\r\n     * Disposes the rendering manager and its resources.\r\n     */\r\n    public dispose(): void {\r\n        this._sprites.length = 0;\r\n        this._spritesRenderer.texture = null; // Prevent disposal of the shared texture atlas.\r\n        this._spritesRenderer.dispose();\r\n    }\r\n\r\n    private _customSpriteUpdate = (): void => {\r\n        // All the work is done upfront within the sprite render\r\n        // so that we do not need babylon to update back the information\r\n    };\r\n}\r\n"]}