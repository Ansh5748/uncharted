import "@babylonjs/core/Engines/Extensions/engine.dynamicBuffer.js";
import "@babylonjs/core/Shaders/sprites.vertex.js";
import "@babylonjs/core/Shaders/sprites.fragment.js";
import { SpriteRenderer } from "@babylonjs/core/Sprites/spriteRenderer.js";
/**
 * Represents all the sprites from the animation and manages their rendering.
 */
export class RenderingManager {
    /**
     * Creates a new instance of the RenderingManager.
     * @param engine ThinEngine instance used for rendering.
     * @param spriteTexture The texture atlas containing the sprites.
     * @param configuration Configuration options for the rendering manager.
     */
    constructor(engine, spriteTexture, configuration) {
        this._customSpriteUpdate = () => {
            // All the work is done upfront within the sprite render
            // so that we do not need babylon to update back the information
        };
        this._engine = engine;
        this._spritesTexture = spriteTexture;
        this._sprites = [];
        this._configuration = configuration;
        this._spritesRenderer = new SpriteRenderer(this._engine, this._configuration.spritesCapacity, 0);
        this._spritesRenderer.disableDepthWrite = true;
        this._spritesRenderer.autoResetAlpha = false;
        this._spritesRenderer.fogEnabled = false;
        this._spritesRenderer.texture = this._spritesTexture;
    }
    /**
     * Adds a sprite to the rendering manager.
     * @param sprite Sprite to add to the rendering manager.
     */
    addSprite(sprite) {
        this._sprites.push(sprite);
    }
    /**
     * Prepares the rendering manager for rendering.
     */
    ready() {
        this._sprites = this._sprites.reverse();
    }
    /**
     * Renders all the sprites in the rendering manager.
     * @param worldMatrix World matrix to apply to the sprites.
     * @param projectionMatrix Projection matrix to apply to the sprites.
     */
    render(worldMatrix, projectionMatrix) {
        this._engine.clear(this._configuration.backgroundColor, true, false, false);
        this._spritesRenderer.render(this._sprites, 0, worldMatrix, projectionMatrix, this._customSpriteUpdate);
    }
    /**
     * Disposes the rendering manager and its resources.
     */
    dispose() {
        this._sprites.length = 0;
        this._spritesRenderer.texture = null; // Prevent disposal of the shared texture atlas.
        this._spritesRenderer.dispose();
    }
}
//# sourceMappingURL=renderingManager.js.map